<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EventEase</title>
    <base href="/" />
    
    <!-- Basic Security (only what works in meta tags) -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    
    <link rel="stylesheet" href="lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/app.css" />
    <link rel="icon" type="image/png" href="favicon.png" />
    <link href="EventEase.styles.css" rel="stylesheet" />
</head>

<body>
    <div id="app">
        <svg class="loading-progress">
            <circle r="40%" cx="50%" cy="50%" />
            <circle r="40%" cx="50%" cy="50%" />
        </svg>
        <div class="loading-progress-text"></div>
    </div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="." class="reload">Reload</a>
        <span class="dismiss">ðŸ—™</span>
    </div>
    
    <!-- SPA Redirect Script - MUST come BEFORE blazor.webassembly.js -->
    <script type="text/javascript">
        // GitHub Pages SPA - Handle 404 redirects by storing the intended route
        (function() {
            // Store the intended route in sessionStorage
            var currentPath = window.location.pathname;
            var search = window.location.search;
            var hash = window.location.hash;
            
            // Extract route after the repo name
            var pathSegments = currentPath.split('/').filter(function(segment) {
                return segment.length > 0;
            });
            
            if (pathSegments.length > 1) {
                // Remove 'EventEase' from the path and get the actual route
                var route = '/' + pathSegments.slice(1).join('/');
                sessionStorage.setItem('spa-route', route + search + hash);
            }
        })();
    </script>
    
    <script src="_framework/blazor.webassembly.js"></script>
    
    <!-- Handle the stored route after Blazor loads -->
    <script type="text/javascript">
        // Wait for Blazor to be ready, then navigate to the stored route
        function navigateToStoredRoute() {
            var storedRoute = sessionStorage.getItem('spa-route');
            if (storedRoute) {
                sessionStorage.removeItem('spa-route');
                // Use setTimeout to ensure Blazor router is fully initialized
                setTimeout(function() {
                    window.history.replaceState(null, null, storedRoute);
                    // Trigger a popstate event to make Blazor router handle the route
                    window.dispatchEvent(new PopStateEvent('popstate'));
                }, 100);
            }
        }
        
        // Try to navigate when Blazor is ready
        document.addEventListener('DOMContentLoaded', function() {
            // Wait a bit longer for Blazor to initialize
            setTimeout(navigateToStoredRoute, 500);
        });
    </script>
</body>

</html>